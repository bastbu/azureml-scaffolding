#!/usr/bin/env bash
#? Format and lint all Python files with Ruff and Pyright

set -eo pipefail
cd "$(dirname "$0")/../.."

# Usage documentation
function usage {
    cat<<EOF
Usage: $0 [--fix]

Options:
  --fix    Automatically fix issues with Ruff
EOF
}

while :; do
    case $1 in
        -h|--help) usage; exit ;;
        --fix) fix=1 ;;
        *) break ;;
    esac
    shift
done

source bin/env .env
poetry run ruff format "$CODE_PATH"

if [[ $fix ]]; then
    poetry run ruff check --fix --exit-non-zero-on-fix "$CODE_PATH"
else
    poetry run ruff check "$CODE_PATH"
fi

poetry run pyright "$CODE_PATH"
